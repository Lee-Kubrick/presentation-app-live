<!DOCTYPE html>
<html>
<head>
  <title>Live Poll Presenter</title>
  <!-- Load p5.js for drawing -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <!-- Load Socket.IO to connect with Python server -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
  </style>
</head>
<body>
<script>
let socket;
let dots = {};  // { user_id: {x, y, targetX, targetY} }
let options = ["<1.52M", "1.53–1.60M", "1.61–1.73M", "1.74–1.85M", "1.86–1.96M", ">1.96M"];
let wigglePhase = 0;

function setup() {
  createCanvas(windowWidth, windowHeight);

  // Connect to the running server
  const socket = io("https://presentation-app-live.onrender.com");

  // When the server tells us there are votes
  socket.on("update_votes", (voteData) => {
  for (let user_id in voteData) {
    const choice = voteData[user_id];

    if (!dots[user_id]) {
      dots[user_id] = {
        x: random(width),
        y: random(height),
        choice: choice
      };
    }
    dots[user_id].choice = choice;
  }
});

}

function draw() {
  background(0);
  noStroke();
  fill('#00bfff');

  wigglePhase += 0.05;
  let spacing = width / (options.length + 1);

  // Group dots by column
  let groups = {};

  for (let id in dots) {
    const choice = dots[id].choice;
    if (!groups[choice]) groups[choice] = [];
    groups[choice].push(id);
  }

  // Draw each group
  for (let col in groups) {
    const dotIds = groups[col];
    const colX = spacing * (parseInt(col) + 1);
    for (let i = 0; i < dotIds.length; i++) {
      const id = dotIds[i];

      let d = dots[id];
      let targetX = colX;
      let targetY = height / 2 + (i - dotIds.length / 2) * 18; // vertical stacking

      d.x += (targetX - d.x) * 0.2;
      d.y += (targetY - d.y) * 0.2;

      let wiggle = sin(wigglePhase + i * 0.3) * 2;

      circle(d.x + wiggle, d.y, 14);
    }
  }

  // Draw labels
  fill(255);
  textSize(16);
  textAlign(CENTER);
  for (let i = 0; i < options.length; i++) {
    text(options[i], spacing * (i + 1), height - 30);
  }
}


</script>
</body>
</html>
