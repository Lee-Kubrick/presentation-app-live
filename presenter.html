<!DOCTYPE html>
<html>
<head>
  <title>Live Presenter</title>
  <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; }
    #questionBox { position: absolute; top: 20px; left: 30px; font-size: 28px; }
    #nextBtn { position: absolute; top: 20px; right: 30px; background-color: #00bcd4; color: black; border: none; font-size: 18px; padding: 12px 20px; border-radius: 8px; cursor: pointer; }
    canvas { background: black; display: block; }
    .charts { display: none; padding: 40px; }
    .charts canvas { margin: 20px auto; display: none; }
  </style>
</head>
<body>
  <div id="questionBox">Loading...</div>
  <button id="nextBtn">Next</button>
  <canvas id="dotCanvas" width="1000" height="600"></canvas>
  <div class="charts" id="summaryCharts">
    <canvas id="chart1" width="400" height="300"></canvas>
    <canvas id="chart2" width="400" height="300"></canvas>
    <canvas id="chart3" width="400" height="300"></canvas>
    <canvas id="chart4" width="400" height="300"></canvas>
  </div>

<script>
const questions = [
  { q: "How old are you?", options: ["<13", "13–14", "15–16", "17–18", "18+"] },
  { q: "What’s your favorite time to scroll TikTok?", options: ["Before bed", "Lunch", "After school", "During class 😏", "Never"] },
  { q: "How many hours do you spend on screens daily?", options: ["<2", "2–4", "4–6", "6–8", "8+"] },
  { q: "Your dream weekend looks like…?", options: ["Gaming", "Netflix", "Sports", "Outside", "Sleeping"] },
  { q: "What social platform do you vibe with most?", options: ["TikTok", "Snapchat", "Instagram", "YouTube", "Discord"] },
  { q: "Your vibe is more…", options: ["Introvert", "Extrovert", "Depends on the day"] },
  { q: "What school subject do you like the most?", options: ["Math", "Science", "English", "Art", "Gym"] },
  { q: "How do you learn best?", options: ["Visual", "Hands-on", "Listening", "Reading/Writing"] },
  { q: "What music gets you hyped?", options: ["Hip-hop", "Pop", "Rock", "Chill", "EDM"] },
  { q: "Would you let AI write your homework?", options: ["Absolutely", "Maybe", "No way", "Already did"] }
];

const socket = io("https://presentation-app-server.onrender.com");
const canvas = document.getElementById("dotCanvas");
const ctx = canvas.getContext("2d");
const nextBtn = document.getElementById("nextBtn");
const questionBox = document.getElementById("questionBox");
const summaryDiv = document.getElementById("summaryCharts");

let currentQuestion = -1;
let dots = [];

function drawDots() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  dots.forEach(dot => {
    ctx.beginPath();
    ctx.arc(dot.x + Math.sin(Date.now()/300)*2, dot.y, dot.r, 0, Math.PI * 2);
    ctx.fillStyle = "#00d8ff";
    ctx.fill();
  });
  requestAnimationFrame(drawDots);
}
drawDots();

socket.on("update_votes", votes => {
  dots = Object.values(votes).filter(v => v.question === currentQuestion).map((v, i) => ({
    x: 100 + (v.choice * 150) + Math.random()*10,
    y: 250 + (i % 12) * 15,
    r: 8
  }));
});

nextBtn.onclick = () => {
  currentQuestion++;
  if (currentQuestion === questions.length) {
    canvas.style.display = "none";
    questionBox.innerText = "Learning Style Pie";
    summaryDiv.style.display = "block";
    renderSummary(0);
    return;
  } else if (currentQuestion === questions.length + 1) {
    questionBox.innerText = "Emoji Weekend Bar";
    renderSummary(1);
    return;
  } else if (currentQuestion === questions.length + 2) {
    questionBox.innerText = "Platform Trend vs National";
    renderSummary(2);
    return;
  } else if (currentQuestion === questions.length + 3) {
    questionBox.innerText = "AI Attitude by Age";
    renderSummary(3);
    nextBtn.style.display = "none";
    return;
  }

  questionBox.innerText = questions[currentQuestion].q;
  socket.emit("set_question", currentQuestion);
};

function renderSummary(index = 0) {
  fetch("survey_result_data.json").then(res => res.json()).then(data => {
    const charts = ["chart1", "chart2", "chart3", "chart4"];
    charts.forEach(id => document.getElementById(id).style.display = "none");
    document.getElementById(charts[index]).style.display = "block";

    if (index === 0) {
      new Chart(document.getElementById("chart1"), {
        type: 'pie',
        data: { labels: Object.keys(data.learning_type), datasets: [{ data: Object.values(data.learning_type) }] },
        options: { plugins: { title: { display: true, text: 'Learning Style Pie' } } }
      });
    } else if (index === 1) {
      new Chart(document.getElementById("chart2"), {
        type: 'bar',
        data: { labels: Object.keys(data.weekend), datasets: [{ data: Object.values(data.weekend) }] },
        options: { indexAxis: 'y', plugins: { title: { display: true, text: 'Emoji Weekend Bar' } } }
      });
    } else if (index === 2) {
      new Chart(document.getElementById("chart3"), {
        type: 'bar',
        data: {
          labels: Object.keys(data.platform),
          datasets: [
            { label: "You", data: Object.values(data.platform), backgroundColor: '#42a5f5' },
            { label: "National Avg", data: [0.25,0.2,0.2,0.25,0.1], backgroundColor: '#aaa' }
          ]
        },
        options: { plugins: { title: { display: true, text: 'Platform Trend vs National' } } }
      });
    } else if (index === 3) {
      const ages = Object.keys(data.ai_attitude_by_age["Absolutely"]);
      const datasets = Object.keys(data.ai_attitude_by_age).map(key => ({
        label: key, data: ages.map(a => data.ai_attitude_by_age[key][a] || 0)
      }));
      new Chart(document.getElementById("chart4"), {
        type: 'bar',
        data: { labels: ages, datasets },
        options: { plugins: { title: { display: true, text: 'AI Attitude by Age' } } }
      });
    }
  });
}
</script>
</body>
</html>
