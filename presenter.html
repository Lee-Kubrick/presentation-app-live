
<!DOCTYPE html>
<html>
<head>
    <title>Live Presenter</title>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { margin: 0; font-family: Arial; background: #000; color: white; overflow: hidden; }
        #questionBox {
            position: absolute; top: 20px; left: 30px;
            font-size: 28px; color: white;
        }
        #nextBtn {
            position: absolute; top: 20px; right: 30px;
            background-color: #00bcd4; color: black;
            border: none; font-size: 18px; padding: 12px 20px;
            border-radius: 8px; cursor: pointer;
        }
        canvas { background: black; display: block; }
        .charts { display: none; padding: 40px; }
        .charts canvas { margin: 20px auto; display: block; }
    </style>
</head>
<body>
    <div id="questionBox">Loading...</div>
    <button id="nextBtn">Next</button>
    <canvas id="dotCanvas" width="1000" height="600"></canvas>

    <div class="charts" id="summaryCharts">
        <canvas id="chart1" width="400" height="300"></canvas>
        <canvas id="chart2" width="400" height="300"></canvas>
        <canvas id="chart3" width="400" height="300"></canvas>
        <canvas id="chart4" width="400" height="300"></canvas>
    </div>

<script>
const questions = [
    {
        "q": "What's your favorite school subject?",
        "options": [
            "Math",
            "Science",
            "English",
            "History",
            "Art"
        ]
    },
    {
        "q": "What\u2019s your vibe?",
        "options": [
            "Introvert",
            "Extrovert",
            "Depends on the day"
        ]
    },
    {
        "q": "Which platform do you use most?",
        "options": [
            "TikTok",
            "Snapchat",
            "Instagram",
            "YouTube",
            "Discord"
        ]
    },
    {
        "q": "What's your learning style?",
        "options": [
            "Visual",
            "Hands-on",
            "Listening",
            "Reading/Writing"
        ]
    },
    {
        "q": "What do weekends look like?",
        "options": [
            "Gaming",
            "Netflix",
            "Sports",
            "Outside",
            "Sleeping"
        ]
    },
    {
        "q": "What kind of music do you vibe with?",
        "options": [
            "Hip-hop",
            "Pop",
            "Rock",
            "Chill",
            "EDM"
        ]
    },
    {
        "q": "How do you feel about group projects?",
        "options": [
            "Love it",
            "Hate it",
            "Meh"
        ]
    },
    {
        "q": "Favorite snack during class?",
        "options": [
            "Chips",
            "Candy",
            "Fruit",
            "Nothing",
            "Other"
        ]
    },
    {
        "q": "Do you think data is fun?",
        "options": [
            "Yes",
            "No",
            "Maybe",
            "It\u2019s magic!"
        ]
    },
    {
        "q": "Would you let AI write your homework?",
        "options": [
            "Absolutely",
            "Maybe",
            "No way",
            "Already did \ud83e\udd2b"
        ]
    }
];

const socket = io("https://presentation-app-server.onrender.com");
const canvas = document.getElementById("dotCanvas");
const ctx = canvas.getContext("2d");
const summaryDiv = document.getElementById("summaryCharts");
const questionBox = document.getElementById("questionBox");
const nextBtn = document.getElementById("nextBtn");

let currentQuestion = -1;
let dots = [];

socket.on("connect", () => {
    console.log("Presenter connected");
});

socket.on("update_votes", (votes) => {
    dots = Object.values(votes).filter(v => v.question === currentQuestion).map((v, i) => {
        return {
            x: 300 + (v.choice * 120) + Math.random()*50,
            y: 200 + (i % 10) * 20,
            r: 10 + Math.random()*4
        };
    });
});

function drawDots() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let dot of dots) {
        ctx.beginPath();
        ctx.arc(dot.x + Math.sin(Date.now()/300)*3, dot.y, dot.r, 0, Math.PI*2);
        ctx.fillStyle = "#00d8ff";
        ctx.fill();
    }
    requestAnimationFrame(drawDots);
}

drawDots();

nextBtn.onclick = () => {
    currentQuestion++;
    if (currentQuestion >= questions.length) {
        document.getElementById("dotCanvas").style.display = "none";
        nextBtn.style.display = "none";
        questionBox.style.display = "none";
        summaryDiv.style.display = "block";
        renderSummary();
    } else {
        questionBox.innerText = questions[currentQuestion].q;
        socket.emit("set_question", currentQuestion);
    }
};

function renderSummary() {
    fetch("survey_result_data.json")
        .then(res => res.json())
        .then(data => {
            new Chart(document.getElementById("chart1"), {
                type: 'pie',
                data: {
                    labels: Object.keys(data.learning_type),
                    datasets: [{ data: Object.values(data.learning_type), backgroundColor: ['#42a5f5','#66bb6a','#ffa726','#ab47bc'] }]
                },
                options: { plugins: { title: { display: true, text: 'Learning Style Distribution' } } }
            });
            new Chart(document.getElementById("chart2"), {
                type: 'bar',
                data: {
                    labels: Object.keys(data.weekend),
                    datasets: [{ data: Object.values(data.weekend), backgroundColor: '#00acc1' }]
                },
                options: {
                    plugins: { title: { display: true, text: 'Weekend Vibe (Emoji Style)' } },
                    indexAxis: 'y'
                }
            });
            new Chart(document.getElementById("chart3"), {
                type: 'bar',
                data: {
                    labels: Object.keys(data.platform),
                    datasets: [
                        { label: 'Your Group', data: Object.values(data.platform), backgroundColor: '#42a5f5' },
                        { label: 'National Avg', data: [0.25,0.2,0.2,0.25,0.1], backgroundColor: '#9e9e9e' }
                    ]
                },
                options: { plugins: { title: { display: true, text: 'Platform Use vs National Avg' } } }
            });
            const ages = Object.keys(data.ai_attitude_by_age["Absolutely"]);
            const attitudes = Object.keys(data.ai_attitude_by_age);
            const datasets = attitudes.map(att => {
                return {
                    label: att,
                    data: ages.map(age => data.ai_attitude_by_age[att][age] || 0),
                    stack: 'a'
                };
            });
            new Chart(document.getElementById("chart4"), {
                type: 'bar',
                data: {
                    labels: ages,
                    datasets: datasets
                },
                options: {
                    plugins: { title: { display: true, text: 'AI Attitude by Age Group' } },
                    responsive: true
                }
            });
        });
}
</script>
</body>
</html>
